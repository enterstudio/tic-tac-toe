!function(e){function t(a){if(n[a])return n[a].exports;var i=n[a]={exports:{},id:a,loaded:!1};return e[a].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var a=n(1),i=n(2);n(4),new i({socket:a,container:document.getElementById("game-container")})},function(e,t){var n="https:"===window.location.protocol?"wss://":"ws://",a=new WebSocket(n+window.location.hostname+"/live/");a.addEventListener("open",function(e){requestAnimationFrame(function(){document.getElementById("butterbar").classList.add("hide")})}),a.addEventListener("close",function(e){requestAnimationFrame(function(){document.getElementById("butterbar").classList.remove("hide")})}),e.exports=a,setInterval(function(){a.send(JSON.stringify({action:"ping"}))},3e4)},function(e,t,n){var a=n(3),i="waiting",s="in-progress",r="abandoned",o="finished",d="finished-draw",c=function(e){this.socket=e.socket,this.resetGame(),this.renderer=new a({game:this,container:e.container}),this.renderer.render(),this.socket.addEventListener("open",this.join.bind(this)),this.socket.addEventListener("message",m.bind(this))};c.prototype.resetGame=function(){this.id=null,this.status=i,this.winner=null,this.myTeam=null,this.next="x",this.grid=[[null,null,null],[null,null,null],[null,null,null]]},c.prototype.fillSquare=function(e){this.socket.send(JSON.stringify({action:"fillSquare",data:{gameId:this.id,team:this.myTeam,coords:{x:e.x,y:e.y}}}))},c.prototype.join=function(){this.socket.send(JSON.stringify({action:"joinGame",gameId:null}))},c.prototype.leave=function(){this.socket.send(JSON.stringify({action:"leaveGame",data:{team:this.myTeam}}))},c.prototype.gameOver=function(){setTimeout(function(){this.leave(),this.resetGame(),this.join()}.bind(this),Math.floor(2500*Math.random())+2e3)};var m=function(e){var t;try{t=JSON.parse(e.data)}catch(n){console.error("Received malformed JSON from server: "+e.data),console.error(n.stack)}"function"==typeof h[t.action]&&h[t.action].bind(this)(t)},h={joinGame:function(e){this.id=e.data.gameId,this.myTeam=e.data.team;var t=new Image;"x"===this.myTeam?t.src="/x.png":t.src="/circle.png",h.updateGameStatus.bind(this)({data:{status:"x"===this.myTeam?i:s}}),this.renderer.render(),requestAnimationFrame(function(){document.getElementById("game-team").innerHTML="",document.getElementById("game-team").appendChild(t)}.bind(this))},updateGameStatus:function(e){this.status=e.data.status;var t;switch(this.status){case s:t="In progress";break;case i:t="Waiting for opponent to join";break;case r:t="Abandoned (a player left the game)",this.gameOver();break;case o:t="Finished",this.gameOver();break;case d:t="Draw",this.gameOver()}this.renderer.render(),requestAnimationFrame(function(){document.getElementById("game-status").textContent=t}.bind(this))},updateGrid:function(e){this.grid=e.data.grid,this.renderer.render()},updateWinner:function(e){this.winner=e.data.winner,this.renderer.render()}};e.exports=c},function(e,t){var n="#CC523E",a="#698DCC",i=new Image;i.src="/grid.png";var s=new Image;s.src="/x.png";var r=new Image;r.src="/circle.png";var o=function(e){this.game=e.game,this.canvas=document.createElement("canvas"),this.canvas.width=768,this.canvas.height=768,e.container.innerHTML="",e.container.appendChild(this.canvas),this.canvas.addEventListener("click",h.bind(this)),this.canvas.addEventListener("touchend",h.bind(this))};o.prototype.render=function(){requestAnimationFrame(d.bind(this))};var d=function(){var e=this.canvas.getContext("2d");e.save(),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.drawImage(i,0,0,768,768);for(var t=0;t<this.game.grid.length;t++)for(var o=0;o<this.game.grid[t].length;o++)if(this.game.grid[t][o]){var d=m({x:t,y:o});d.x=d.x+32,d.y=d.y+32;var c="x"===this.game.grid[t][o]?s:r;e.drawImage(c,d.x,d.y,192,192)}if(this.game.winner){var h;"x"==this.game.winner?(h="Red",e.fillStyle=n):(h="Blue",e.fillStyle=a),e.fillRect(0,352,768,64),e.font="48px sans-serif",e.fillStyle="white",e.textBaseline="middle",e.shadowColor="rgba(0, 0, 0, 0.85)",e.shadowBlur=4,e.shadowOffsetY=0,e.textAlign="center",e.fillText(h+" wins!",384,384)}e.restore()},c=function(e){var t={x:0,y:0};return t.x=parseInt(e.x/256),t.y=parseInt(e.y/256),t},m=function(e){var t={x:0,y:0};return t.x=256*e.x,t.y=256*e.y,t},h=function(e){e.preventDefault();var t={x:e.clientX||e.changedTouches[0].clientX,y:e.clientY||e.changedTouches[0].clientY},n={x:0,y:0};n.x=(t.x-this.canvas.offsetLeft)*this.canvas.width/this.canvas.offsetWidth,n.y=(t.y-this.canvas.offsetTop)*this.canvas.height/this.canvas.offsetHeight;var a=c(n);this.game.fillSquare(a)};e.exports=o},function(e,t,n){var a=n(1),i=function(e){var t;try{t=JSON.parse(e.data)}catch(n){console.error("Received malformed JSON from server: "+e.data),console.error(n.stack)}"function"==typeof s[t.action]&&s[t.action](t.data)},s={statsUpdate:function(e){var t={totalMoves:document.getElementById("total-moves"),totalGames:document.getElementById("total-games"),abandonedGames:document.getElementById("abandoned-games"),tiedGames:document.getElementById("tied-games"),wonByX:document.getElementById("won-by-x"),wonByO:document.getElementById("won-by-o")};e.forEach(function(e){t[e.id]&&e.value.toString()!==t[e.id].textContent&&requestAnimationFrame(function(){t[e.id].textContent=e.value.toString()})})}};a.addEventListener("message",i)}]);